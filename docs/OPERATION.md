# 運用ガイド

## 概要

このドキュメントでは、Kenji Hubの運用方法、特にブランチ戦略とデプロイフローについて説明します。

## Kenji Hubのブランチ戦略

### 採用している戦略

Kenji Hubでは、**GitHub Flow**を採用しています。

```
main (本番環境)
  ↑
feature/新機能名
```

### ブランチ構成

- **main**: 本番環境にデプロイされるブランチ
- **feature/***: 新機能や修正を開発するブランチ

### ワークフロー

1. `main`ブランチから`feature/新機能名`ブランチを作成
2. 機能開発・修正を実施
3. ローカルでテスト（`npm run dev`）
4. リントチェック（`npm run lint`）
5. `main`ブランチにプルリクエストを作成
6. マージ後、GitHub Actionsが自動でデプロイ

### 安定版と開発版の分離

Kenji Hubでは、**安定版と開発版の分離は行っていません**。

理由：
- 個人開発で迅速な更新を重視
- シンプルな運用を優先
- 自動デプロイ（GitHub Actions）で品質を担保
- ローカルテストで十分な検証が可能

### ブランチ設定

GitHub上でのブランチ保護ルールなどの設定方法については、[ブランチ設定ガイド](./BRANCH_SETUP.md)を参照してください。

## デプロイフロー

### 自動デプロイ設定

Kenji Hubは、以下の設定で自動デプロイされています：

```yaml
# .github/workflows/deploy.yml
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
```

**動作：**
1. `main`ブランチにpush、または`main`へのプルリクエスト
2. GitHub Actionsが自動でビルド
3. ビルド成功後、GitHub Pagesに自動デプロイ（`main`ブランチのみ）
4. 数分後に本番環境（https://kmh-no3.github.io/kenji-hub/）に反映

### デプロイ手順（概要）

運用時の変更は、次の流れで行います：

1. `main` または `feature/〜` ブランチで変更を行う  
2. ローカルで動作確認と品質チェックを行う  
   - 開発サーバー起動・リント・ビルドの具体的なコマンドは、`docs/DEVELOPMENT.md` の「セットアップ」「利用可能なスクリプト」を参照  
3. コミットして `main` へプッシュ、またはプルリクエストを作成  
4. GitHub Actions により自動ビルド・デプロイが実行され、サイトに反映される

※ ローカル開発やDocker環境など、開発環境に関する詳細な手順は **開発ガイド (`DEVELOPMENT.md`)** に集約しています。

## 運用フロー

### 日常的な更新（小規模な変更）

```
1. mainブランチから直接作業
2. ローカルでテスト（npm run dev）
3. リントチェック（npm run lint）
4. コミット & プッシュ
5. 自動デプロイ
```

### 新機能の追加（中規模な変更）

```
1. feature/新機能名ブランチを作成
   git checkout -b feature/新機能名

2. 機能開発

3. ローカルでテスト
   npm run dev
   npm run lint
   npm run build:static

4. プルリクエスト作成
   git push origin feature/新機能名
   # GitHubでプルリクエストを作成

5. マージ
   # プルリクエストをマージ

6. 自動デプロイ
   # GitHub Actionsが自動でデプロイ
```

### 緊急修正

```
1. mainブランチから直接作業
2. 最小限の変更
3. ローカルでテスト
4. コミット & プッシュ
5. 自動デプロイ
6. 動作確認
```

## コミットメッセージ規約

Kenji Hubでは、Conventional Commits形式を使用しています：

```
feat: 新機能の追加
fix: バグ修正
docs: ドキュメント更新
style: コードスタイルの変更（フォーマット、セミコロンなど）
refactor: リファクタリング
test: テストの追加・修正
chore: ビルドプロセスやツールの変更
```

## バックアップとロールバック

### タグの作成

重要な変更前にタグを作成：

```bash
# タグの作成
git tag -a v1.0.0 -m "リリース v1.0.0"
git push origin v1.0.0
```

### ロールバック

問題が発生した場合：

1. GitHubのリリース機能を確認
2. 前のコミットに戻す
3. 必要に応じて、タグから復元

## トラブルシューティング

### デプロイが失敗する場合

1. **GitHub Actionsのログを確認**
   - リポジトリの「Actions」タブを確認
   - エラーメッセージを確認

2. **ローカルでビルドテスト**
   ```bash
   npm run build:static
   ```

3. **依存関係の確認**
   ```bash
   npm ci
   ```

### デプロイが反映されない場合

1. **GitHub Pagesの設定を確認**
   - リポジトリの「Settings」→「Pages」
   - ソースブランチが正しく設定されているか確認

2. **キャッシュのクリア**
   - ブラウザのキャッシュをクリア
   - または、シークレットモードで確認

3. **デプロイの完了を待つ**
   - GitHub Actionsの完了を確認
   - 通常、数分かかります
